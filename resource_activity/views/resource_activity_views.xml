<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
		<menuitem name="Activities" id="menu_resource_activity" parent="resource_planning.menu_main_resource_planning" sequence="20"/>
		
		
		<record id="resource_location_form" model="ir.ui.view">
            <field name="name">resource.location.form</field>
            <field name="model">resource.location</field>
            <field name="inherit_id" ref="resource_planning.resource_location_form"/>
            <field name="arch" type="xml">
            	<page name="users" position="after">
           			<page name="guides" string="Guides">
           				<field name="guides">
            				<tree delete="false" create="false">
            					<field name="name"/>
            				</tree>
            			</field>
           			</page>
            		<page name="trainers" string="Trainers">
           				<field name="trainers">
            				<tree delete="false" create="false">
            					<field name="name"/>
            				</tree>
            			</field>
           			</page>
           		</page>
            </field>
        </record>

		<record id="view_resource_activity_tree" model="ir.ui.view">
            <field name="name">resource.activity.tree</field>
            <field name="model">resource.activity</field>
            <field name="arch" type="xml">
				<tree>
					<field name="description"/>
					<field name="name"/>
					<field name="partner_id"/>
					<field name="activity_type"/>
					<field name="date_start"/>
					<field name="date_end"/>
					<field name="location_id"/>
					<field name="state"/>
				</tree>
            </field>
        </record>
		
		<record id="view_resource_activity_form" model="ir.ui.view">
            <field name="name">resource.activity.form</field>
            <field name="model">resource.activity</field>
            <field name="arch" type="xml">
				<form>
					<header>
						<button name="action_confirm" string="Confirm" type="object" states="draft"/>
						<button name="action_draft" string="Draft" type="object" states="confirmed"/>
						<button name="action_done" string="Done" type="object" states="confirmed"/>
						<button name="action_cancel" string="Cancel" type="object" states="draft,confirmed" confirm="Are you sure you want to cancel this activity?"/>
						<field name="state" widget="statusbar"/>
					</header>
					<sheet>
						 <div class="oe_button_box" name="button_box">
	                        <button name="toggle_active" type="object" groups="resource_planning.group_resource_user"
	                                class="oe_stat_button" icon="fa-archive">
	                            <field name="active" widget="boolean_button"
	                                options='{"terminology": "archive"}'/>
	                        </button>
	                    </div>
						<h1 class="mt0">
	                  		<field name="name" readonly="1" class="oe_inline"/>
	                   	</h1>
						<group>
							<group>
								<field name="description"/>
								<field name="partner_id"/>
								<field name="location_id" widget="selection"/>
								<field name="registrations_max"/>
								<field name="registrations_min"/>
								<field name="registrations_expected"/>
								<field name="need_delivery"/>
								<field name="delivery_place" attrs="{'invisible':[('need_delivery','=',False)]}"/>
								<field name="delivery_time" attrs="{'invisible':[('need_delivery','=',False)]}"/>
								<field name="company_id" invisible="True"/>
							</group>
							<group>
								<field name="date_start"/>
								<field name="date_end"/>
								<field name="duration"/>
								<field name="booking_type"/>
								<field name="date_lock" attrs="{'invisible':[('booking_type','!=','option')],'required':[('booking_type','=','option')]}"/>
								<field name="activity_type" widget="selection"/>
								<field name="activity_theme" widget="selection"/>
								<field name="departure"/>
								<field name="arrival"/>
								<field name="langs" options="{'no_create': True}" widget='many2many_tags'/>
								<field name="comment"/>
							</group>
						</group>
						<notebook>
	            			<page name="registration" string="Registrations">
	            				<button type="object" name="search_all_resources" string="Search all"/>
	            				<button type="object" name="reserve_needed_resource" string="Reserve needed Resources" help="refresh"/>
	            				<field name="registrations" context="{'default_booking_type':booking_type,'default_date_lock':date_lock,'default_registrations_max':registrations_max,'default_registrations_expected':registrations_expected}">
	            					<tree delete="false" editable="bottom">
										<button type="object" icon="STOCK_FIND" name="view_registration_form" />
	            						<field name="partner_id" invisible="True"/>
	            						<field name="registrations_max" invisible="True"/>
										<field name="registrations_expected" invisible="True"/>
	            						<field name="attendee_id" attrs="{'required':[('partner_id','=',False)]}"/>
	            						<field name="bring_bike"/>
	            						<field name="quantity" sum="Total participant"/>
	            						<field name="quantity_needed" sum="Total needed"/>
	            						<field name="quantity_allocated" sum="Total allocated"/>
	            						<field name="resource_category" attrs="{'required':[('bring_bike','=',False)]}"/>
	            						<field name="booking_type"/>
	            						<field name="date_lock" attrs="{'required':[('booking_type','=','option')]}"/>
	            						<field name="state"/>
					                    <button type="object" name="search_resources" states="draft" help="Search resources" icon="gtk-apply"/>
					                    <button type="object" name="action_cancel" states="draft" help="Cancel" icon="gtk-cancel"/>
	            					</tree>
	            				</field>
	            			</page>
	            			<page name="guides" string="Guides">
	            				<field name="guides"/>
	            			</page>
	            			<page name="trainers" string="Trainers">
	            				<field name="trainers"/>
	            			</page>
	            		</notebook>
					</sheet>
					<div class="oe_chatter">
	                    <field name="message_follower_ids" widget="mail_followers"/>
	                    <field name="message_ids" widget="mail_thread"/>
                    </div>
				</form>
            </field>
        </record>
        
        <record id="view_resource_activity_calendar" model="ir.ui.view">
            <field name="name">resource.activity.calendar</field>
            <field name="model">resource.activity</field>
            <field eval="3" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="activity_type" date_start="date_start" display="[description]"
                		date_stop="date_end" quick_add="false" string="Activities">
                    <field name="description"/>
                    <field name="booking_type"/>
                    <field name="partner_id"/>
                    <field name="location_id"/>
                </calendar>
            </field>
        </record>
        
        <record id="view_resource_activity_filter" model="ir.ui.view">
            <field name="name">resource.activity.search</field>
            <field name="model">resource.activity</field>
            <field name="arch" type="xml">
                <search string="Search Activity">
                    <filter name="end_today" string="End today"
                        domain="[('date_end', '&gt;=', time.strftime('%Y-%m-%d 00:00:00')),('date_end', '&lt;=', time.strftime('%Y-%m-%d 23:59:59'))]"/>
                    <filter name="today" string="Today"
                    	domain="[('date_start','&lt;=', time.strftime('%Y-%m-%d %H:%M:%S')), ('date_end','&gt;=', time.strftime('%Y-%m-%d %H:%M:%S'))]"/>
                    <field name="partner_id" string="Partner"/>
                    <field name="location_id" string="location" groups="resource_planning.group_multi_location"/>
                    <filter string="Draft" name="draft" domain="[('state','=','draft')]"/>
                    <filter string="Option" name="option" domain="[('state','=','option')]"/>
                    <filter string="Booked" name="booked" domain="[('state','=','booked')]"/>
                    <filter string="Not cancelled" name="not_cancelled" domain="[('state','!=','cancelled')]"/>
                    <separator/>
                    <group string="Group By...">
                        <filter name="location" string="Location" domain="[]" context="{'group_by':'location_id'}"/>
                        <filter name="activity_type" string="Activity Type" domain="[]" context="{'group_by':'activity_type'}"/>
                        <filter name="customer" string="Customer" domain="[]" context="{'group_by':'activity_type'}"/>
                    </group>
               </search>
            </field>
        </record>
        
        <record id="view_resource_activity_calendar" model="ir.ui.view">
            <field name="name">resource.activity.calendar</field>
            <field name="model">resource.activity</field>
            <field eval="3" name="priority"/>
            <field name="arch" type="xml">
                <calendar color="activity_type" date_start="date_start" date_stop="date_end" string="Activities">
                    <field name="description"/>
                    <field name="booking_type"/>
                    <field name="partner_id"/>
                </calendar>
            </field>
        </record>

        <record id="action_resource_activity" model="ir.actions.act_window">
            <field name="name">Resource activities</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">resource.activity</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="context">{"search_default_today":1,"search_default_not_cancelled":1}</field>
        </record>
        
        <menuitem action="action_resource_activity" id="resource_activity_menu" parent="menu_resource_activity" sequence="10"/>
        
        <record id="view_activity_registration_form" model="ir.ui.view">
            <field name="name">activity.registration.form</field>
            <field name="model">resource.activity.registration</field>
            <field name="arch" type="xml">
				<form>
					<header>
						<button type="object" name="search_resources" string="Search" states="draft,waiting,available" help="Search resources"/>
						<button name="action_cancel" string="Cancel" type="object" states="draft, booked, option" confirm="Are you sure you want to cancel this registration?"/>
						<field name="state" widget="statusbar"/>
					</header>
					<sheet>
						<group>
							<group>
								<field name="partner_id" invisible="True"/>
								<field name="attendee_id" attrs="{'required':[('partner_id','=',False)]}"/>
								<field name="bring_bike"/>
								<field name="quantity"/>
								<field name="quantity_allocated"/>
							</group>
							<group>
								<field name="booking_type"/>
								<field name="date_lock" attrs="{'invisible':[('booking_type','!=','option')]}"/>
           						<field name="resource_category" attrs="{'required':[('bring_bike','=',False)]}"/>
								<field name="registrations_max" invisible="True"/>
								<field name="registrations_expected" invisible="True"/>
							</group>
						</group>
						<notebook>
							<page string="Search result">
								<button type="object" name="action_refresh" string="Refresh" help="refresh"/>
								<button type="object" name="reserve_needed_resource" string="Reserve needed Resources" help="refresh"/>
								<field name="resources_available" options="{'no_open':True,'no_create':True}">
									<tree>
										<field name="name"/>
										<field name="resource_id"/>
										<field name="state"/>
										<button type="object" name="action_reserve" states="free" help="Book" icon="STOCK_MEDIA_PLAY"/>
										<button type="object" name="action_cancel" states="selected" help="Cancel" icon="gtk-cancel"/>
									</tree>
								</field>
							</page>
							<page string="Resource Allocations">
								<field name="allocations">
									<tree>
										<field name="name"/>
										<field name="serial_number"/>
										<field name="resource_id"/>
										<field name="resource_category_id"/>
										<field name="date_start"/>
										<field name="date_end"/>
										<field name="state"/>
									</tree>
								</field>
							</page>
						</notebook>
					</sheet>
				</form>
            </field>
        </record>

        <record id="resource_activity_type_tree" model="ir.ui.view">
            <field name="name">resource.activity.type.tree</field>
            <field name="model">resource.activity.type</field>
            <field name="arch" type="xml">
                <tree string="Resource activity type" delete="false">
	                <field name="name"/>
	                <field name="code"/>
                </tree>
            </field>
        </record>
        
        <record id="view_resource_activity_type_form" model="ir.ui.view">
            <field name="name">resource.activity.type.form</field>
            <field name="model">resource.activity.type</field>
            <field name="arch" type="xml">
                <form string="Resource activity type">
		            <sheet>
		            	<group>
			            	<group>
			                    <field name="name"/>
			               	</group>
			               	<group>
			               		<field name="code"/>
			               	</group>
		            	</group>
		        	</sheet>
		        </form>
		    </field>
		</record>
		
		<record id="action_resource_activity_type" model="ir.actions.act_window">
            <field name="name">Resource activity type</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">resource.activity.type</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>
        
        <menuitem action="action_resource_activity_type" id="resource_activity_type_menu" parent="resource_planning.menu_resource_configuration" sequence="70"/>
       
        <record id="resource_activity_lang_tree" model="ir.ui.view">
            <field name="name">resource.activity.lang.tree</field>
            <field name="model">resource.activity.lang</field>
            <field name="arch" type="xml">
                <tree string="Resource activity lang" delete="false">
	                <field name="name"/>
	                <field name="code"/>
                </tree>
            </field>
        </record>
        
        <record id="view_resource_activity_lang_form" model="ir.ui.view">
            <field name="name">resource.activity.lang.form</field>
            <field name="model">resource.activity.lang</field>
            <field name="arch" type="xml">
                <form string="Resource activity lang">
		            <sheet>
		            	<group>
			            	<group>
			                    <field name="name"/>
			               	</group>
			               	<group>
			               		<field name="code"/>
			               	</group>
		            	</group>
		        	</sheet>
		        </form>
		    </field>
		</record>
		
		<record id="action_resource_activity_lang" model="ir.actions.act_window">
            <field name="name">Resource activity lang</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">resource.activity.lang</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>
        
        <menuitem action="action_resource_activity_lang" id="resource_activity_lang_menu" parent="resource_planning.menu_resource_configuration" sequence="80"/>

        <record id="resource_activity_theme_tree" model="ir.ui.view">
            <field name="name">resource.activity.theme.tree</field>
            <field name="model">resource.activity.theme</field>
            <field name="arch" type="xml">
                <tree string="Resource activity theme" delete="false">
	                <field name="name"/>
	                <field name="code"/>
                </tree>
            </field>
        </record>
        
        <record id="view_resource_activity_theme_form" model="ir.ui.view">
            <field name="name">resource.activity.theme.form</field>
            <field name="model">resource.activity.theme</field>
            <field name="arch" type="xml">
                <form string="Resource activity theme">
		            <sheet>
		            	<group>
			            	<group>
			                    <field name="name"/>
			               	</group>
			               	<group>
			               		<field name="code"/>
			               	</group>
		            	</group>
		        	</sheet>
		        </form>
		    </field>
		</record>
		
		<record id="action_resource_activity_theme" model="ir.actions.act_window">
            <field name="name">Resource activity theme</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">resource.activity.theme</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>
        
        <menuitem action="action_resource_activity_theme" id="resource_activity_theme_menu" parent="resource_planning.menu_resource_configuration" sequence="90"/>
	</data>
</odoo>